#!/usr/bin/env python

import os, sys, time, thread
from pymongo 

DBPATH = os.path.abspath( __file__ + "/../../data")
DEBUG  = True

if DEBUG :
  print "DBPATH = " + DBPATH

#############
#  CLEADIR  #
#############
def cleandir() :
  if os.path.exists( "./mongoid.txt" ) :
    os.system( "rm ./mongoid.txt" )

#####################
#  OPENING MESSAGE  #
#####################
def printOpening() :
  print ">>> *************************  <<<"
  print ">>>           PIPER            <<<"
  print ">>>                            <<<"
  print ">>> STARTING MONGO DB INSTANCE <<<"
  print ">>> *************************  <<<"
  print 
  print 


#####################
#  CREATE INSTANCE  #
#####################
def createInstance() :
  print "Creating mongo db instance at " + DBPATH + "\n\n"
  os.system( "mongod --dbpath " + DBPATH + " &" )

##########
#  MAIN  #
##########
def main() :

  # ---------------------------------------------------- #
  # prelims
  cleandir()
  printOpening()

  # ---------------------------------------------------- #
  # create mongo instance
  #thread.start_new_thread( createInstance, () )
  createInstance()
  time.sleep( 10 )

  # ---------------------------------------------------- #
  # do stuff
  print "stuff!!!"

  # ---------------------------------------------------- #
  # close mongo db instance
  # get instance id
  os.system( "pgrep mongod 2>&1 | tee dbid.txt" )
  fo     = open( "dbid.txt", "r" )
  dbid   = fo.readline()
  fo.close()

  if DEBUG :
    print "dbid = " + dbid 

  os.system( "kill " + dbid ) 


##############################
#  MAIN THREAD OF EXECUTION  #
##############################
main()
